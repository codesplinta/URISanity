{"version":3,"file":"urisanity.js","sources":["../src/index.js"],"sourcesContent":["/** !\n * @author: https://twitter.com/isocroft\n * @owner: https://twitter.com/codesplinta\n *\n * @Copyright (c) 2021 - 2022\n *\n * @sourced: [first-party] https://github.com/braintree/sanitize-url\n *\n * Based on the well known URI schemes;\n * See: https://en.wikipedia.org/wiki/List_of_URI_schemes\n *\n * @created: 23/06/2021\n * @last-updated: 12/02/2022\n */\n\n/* eslint-disable no-useless-escape */\n\n/* @HINT: all URI schemes that are mostly unsafe for web browsers to launch */\nconst unsafeURISchemeRegex =\n  /^([^\\w]*)(javascript|vbscript|app|admin|icloud-sharing|icloud-vetting|file|help|aim|facetime-audio|applefeedback|ibooks|macappstore|udoc|ts|st|x-apple-helpbasic|(?:x\\-)?radar)/im\n/* @HINT: all URI schemes that are mostly safe for web browsers to launch */\nconst safeInternetURISchemeRegex =\n  /^(?:(?:f|ht)tps?|cid|xmpp|mms|webcal|aaa|acap|bolo|data|blob|wss?|irc|udp)/im\n/* @CHECK: https://gist.github.com/gruber/249502/61cbb59f099fdf90316c4e409c7523b6d5124f80 */\nconst safeURIRegex =\n  /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/?)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)){0,}(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s\\!()\\[\\]{};:\\'\\\"\\.\\,<>?«»“”‘’]){0,})/i\n/* @HINT: */\nconst commsAppURISchemeRegex =\n  /^(whatsapp|zoommtg|slack|mailto|tel|callto|sms|skype)/im\nconst databaseConnectionStringURISchemeRegex =\n  /^(jdbc(:sqlserver|:mysql|:mariadb|:sqlite)?|odbc|postgres(ql)?|mongodb)/im\nconst browserURISchemeRegex = /^(view-source|moz-extension|chrome-extension)/im\nconst serviceAPIURISchemeRegex = /^(cloudinary|gs|s3|grpc)/im\n/* @HINT: */\nconst ctrlCharactersRegex =\n  /[\\u0000-\\u001F\\u007F-\\u009F\\u2000-\\u200D\\uFEFF]/gim; /* eslint-disable-line */\n// const urlSchemeRegex = /^([^:]+):/gm\n/* @CHECK: https://datatracker.ietf.org/doc/html/rfc2397 - DATA URI */\n/* @CHECK: https://www.w3.org/TR/FileAPI/#blob-url - BLOB URL */\nconst dataURIRegex =\n  /^(?:data:([\\w-.]+\\/[\\w-.]+(\\+[\\w-.]+)?)?(;[\\w-.]+=[\\w-.]+)*;base64,([a-zA-Z0-9\\/+\\n=]+))$/\nconst scriptURIRegex = /^(?:vb|java)script:/i\nconst webTransportURIRegex = /^(?:(blob:)?https?|wss?|about)/im\nconst relativeFirstCharacters = ['.', '/']\n\n/* @HINT: Global Stub for the Browser, ReactNative, NativeScript, NodeJS */\nconst $globals = typeof self === 'undefined' ? global || {} : self\n/* @HINT: Conditionally access the NodeJS process global */\nconst nodeJSProcess = $globals.process || { versions: { node: '.' }, env: {} }\nconst NODE_MAJOR_VERSION = parseInt(nodeJSProcess.versions.node.split('.')[0])\n\n/* @CHECK: https://developer.mozilla.org/en-US/docs/Web/API/URL#browser_compatibility */\nif (NODE_MAJOR_VERSION <= 12) {\n  if (!$globals.URL) {\n    $globals.URL = function (urlString) {\n      const urlParser = require('url')\n      /* urlParser.parse(): deprecarted in NodeJS v11.x */\n      const parsedUrl =\n        NODE_MAJOR_VERSION <= 11\n          ? urlParser.parse(urlString) /* eslint-disable-line */\n          : urlParser.URL(urlString)\n      return Object.assign({}, parsedUrl, { hostname: parsedUrl.host })\n    }\n  }\n}\n\nfunction isStandardBrowserEnv () {\n  const environ = $globals.navigator\n  return (\n    typeof environ !== 'undefined' &&\n    environ.product.match(/^(ReactNative|NativeScript|NS)$/i) === null\n  )\n}\n\nconst origin = isStandardBrowserEnv()\n  ? $globals.location.origin\n  : ($globals.constants || nodeJSProcess.env).ORIGIN\n\nfunction isRelativeUrlWithoutProtocol (url) {\n  if (typeof url === 'string') {\n    return relativeFirstCharacters.indexOf(url.charAt(0)) > -1\n  }\n  return false\n}\n\n/* @CHECK: https://gist.github.com/blafrance/4053759 */\nfunction extractParamValueFromUri (uri, paramName) {\n  if (!uri) {\n    return\n  }\n\n  const regex = new RegExp('[\\\\?&#]' + paramName + '=([^&#]*)')\n  const params = regex.exec(uri)\n  if (params != null) {\n    return unescape(params[1])\n  }\n}\n\nfunction formDataToJSON (elem) {\n  let current, item, key, output, value\n  output = {}\n\n  const entries =\n    elem instanceof $globals.FormData\n      ? elem.entries()\n      : new $globals.FormData(elem).entries()\n\n  try {\n    // Iterate over values, and assign to item.\n    while ((item = entries.next().value) !== null) {\n      // assign to variables to make the code more readable.\n      key = item[0]\n      value = item[1]\n      // Check if key already exist\n      if (Object.prototype.hasOwnProperty.call(output, key)) {\n        current = output[key]\n        if (!Array.isArray(current)) {\n          // If it's not an array, convert it to an array.\n          current = output[key] = [current]\n        }\n        current.push(value) // Add the new value to the array.\n      } else {\n        output[key] = value\n      }\n    }\n  } catch (_) {\n    output = Object.fromEntries(entries)\n  }\n\n  return JSON.stringify(output)\n}\n\nfunction isSameOrigin (uri) {\n  if (!uri) {\n    return\n  }\n\n  const parsedUrl = new $globals.URL(uri)\n  return origin === parsedUrl.origin\n}\n\nfunction checkParamsOverWhiteList (uri, paramsWhiteList = [], data = '') {\n  const parsedUrl = new $globals.URL(uri)\n  const paramKeys = []\n  const paramValues = []\n  let preparedData = null\n\n  try {\n    let json = ''\n    if ('FormData' in $globals && data instanceof $globals.FormData) {\n      if (typeof Object.fromEntries === 'function') {\n        json = formDataToJSON(data)\n      } else {\n        const object = {}\n\n        data.forEach(function (value, key) {\n          object[key] = value\n        })\n\n        json = JSON.stringify(object)\n      }\n    } else {\n      json = data\n    }\n\n    if (typeof json === 'string') {\n      preparedData = JSON.parse(json)\n    }\n  } catch (_) {\n    preparedData = data\n  }\n\n  if (preparedData === '') {\n    parsedUrl.searchParams.forEach(function (...args) {\n      const [value, key] = args\n\n      paramValues.push(unescape(value))\n      paramKeys.push(key)\n    })\n  } else {\n    if (preparedData instanceof Object) {\n      paramValues.concat(Object.values(preparedData))\n      paramKeys.concat(Object.keys(preparedData))\n    }\n  }\n\n  /* @HINT: Check that only the request params we need are attached */\n  /* @HINT: Any other extra params should not be allowed */\n  if (paramKeys.length === paramsWhiteList.length) {\n    return true\n  }\n\n  return false\n}\n\nfunction sanitizeUrl (url, options = {}) {\n  if (\n    !url ||\n    url.match(/:\\/\\/(?:[#$@=*.!]|[/]){0,}$/) !== null ||\n    url.includes('////////////')\n  ) {\n    return 'about:blank'\n  }\n\n  let sanitizedUrl = url.replace(ctrlCharactersRegex, '').trim()\n\n  if (isRelativeUrlWithoutProtocol(sanitizedUrl)) {\n    const originalSanitized = sanitizedUrl.startsWith('/')\n      ? origin + sanitizedUrl\n      : origin + '/' + sanitizedUrl\n    sanitizedUrl = safeURIRegex.test(originalSanitized)\n      ? originalSanitized\n      : '//'\n  }\n\n  let urlSchemeParseResults =\n    sanitizedUrl.match(safeInternetURISchemeRegex) ||\n    sanitizedUrl.match(commsAppURISchemeRegex) ||\n    sanitizedUrl.match(databaseConnectionStringURISchemeRegex) ||\n    sanitizedUrl.match(browserURISchemeRegex)\n\n  urlSchemeParseResults =\n    urlSchemeParseResults !== null ? urlSchemeParseResults : []\n  const urlScheme = urlSchemeParseResults[0] || ''\n\n  const { hostname, pathname, search, hash } = new $globals.URL(\n    sanitizedUrl.toLowerCase()\n  )\n\n  /* @CHECK: https://en.wikipedia.org/wiki/Hostname#Restrictions_on_valid_host_names */\n  /* CHECK: https://datatracker.ietf.org/doc/html/rfc3986 */\n  if (\n    /^(?:((?:www|[a-z]{1,11})\\.)(?!\\1)(?:[a-z\\-\\d]{1,63})\\.(?:[a-z.\\-\\d]{2,63}))$/i.test(\n      hostname\n    ) ||\n    /^(((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/.test(\n      hostname\n    ) ||\n    /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/.test(\n      hostname\n    ) ||\n    /^(?:((?:[a-z0-9-._~]{0,}|%[1-9a-f]?[0-9a-f]|[!$&'()*+,;=])|\\:|\\@)*)/i.test(\n      pathname\n    ) ||\n    /^((?:[a-z0-9-._~]{0,}|%[1-9a-f]?[0-9a-f]|[!$&'()*+,;=])|\\:|\\@|\\/|\\?)*$/i.test(\n      search\n    ) ||\n    /^((?:[a-z0-9-._~]{0,}|%[1-9a-f]?[0-9a-f]|[!$&'()*+,;=])|\\:|\\@|\\/|\\?)*$/i.test(\n      hash\n    )\n  ) {\n    if (hostname.includes('.00')) {\n      return 'about:blank'\n    }\n\n    if (\n      search.toLowerCase().match(/%3c(?=\\/)?/g) !== null &&\n      search.toLowerCase().includes('%3e') &&\n      search.toLowerCase().includes('%3f') &&\n      search.toLowerCase().includes('%3d') &&\n      search.toLowerCase().includes('%27') &&\n      search.toLowerCase().includes('%22') &&\n      search.toLowerCase().match(/\\.(?:jar|dmg|exe|bin|sh|sed)/g) !== null\n    ) {\n      return 'about:blank'\n    }\n  }\n\n  if (\n    !unsafeURISchemeRegex.test(urlScheme) ||\n    safeURIRegex.test(sanitizedUrl)\n  ) {\n    let pass = false\n\n    if (\n      options.allowScriptOrDataURI &&\n      urlScheme.match(/^(java|vb)script|data/) === null &&\n      (dataURIRegex.test(sanitizedUrl) || scriptURIRegex.test(sanitizedUrl))\n    ) {\n      pass = true\n    }\n\n    if (options.allowCommsAppURI && commsAppURISchemeRegex.test(sanitizedUrl)) {\n      pass = true\n    }\n\n    if (\n      options.allowDBConnectionStringURI &&\n      databaseConnectionStringURISchemeRegex.test(sanitizedUrl)\n    ) {\n      pass = true\n    }\n\n    if (\n      options.allowServiceAPIURI &&\n      serviceAPIURISchemeRegex.test(sanitizedUrl)\n    ) {\n      pass = true\n    }\n\n    if (\n      options.allowBrowserSpecificURI &&\n      browserURISchemeRegex.test(sanitizedUrl)\n    ) {\n      pass = true\n    }\n\n    if (\n      options.allowWebTransportURI &&\n      webTransportURIRegex.test(sanitizedUrl)\n    ) {\n      pass = true\n    }\n\n    if (urlScheme !== '' && pass) {\n      return sanitizedUrl\n    } else {\n      return 'about:blank' // sanitizedUrl;\n    }\n  }\n}\n\nconst URISanity = {\n  isSameOrigin,\n  extractParamValueFromUri,\n  checkParamsOverWhiteList,\n  vet (url, options = {}) {\n    return sanitizeUrl(url, options || {})\n  }\n}\n\nexport default URISanity\n"],"names":["unsafeURISchemeRegex","safeInternetURISchemeRegex","safeURIRegex","commsAppURISchemeRegex","databaseConnectionStringURISchemeRegex","browserURISchemeRegex","serviceAPIURISchemeRegex","ctrlCharactersRegex","dataURIRegex","scriptURIRegex","webTransportURIRegex","relativeFirstCharacters","$globals","self","global","nodeJSProcess","process","versions","node","env","NODE_MAJOR_VERSION","parseInt","split","URL","urlString","urlParser","require","parsedUrl","parse","Object","assign","hostname","host","isStandardBrowserEnv","environ","navigator","product","match","origin","location","constants","ORIGIN","isRelativeUrlWithoutProtocol","url","indexOf","charAt","extractParamValueFromUri","uri","paramName","regex","RegExp","params","exec","unescape","formDataToJSON","elem","current","item","key","output","value","entries","FormData","next","prototype","hasOwnProperty","call","Array","isArray","push","_","fromEntries","JSON","stringify","isSameOrigin","checkParamsOverWhiteList","paramsWhiteList","data","paramKeys","paramValues","preparedData","json","object","forEach","searchParams","args","concat","values","length","sanitizeUrl","options","includes","sanitizedUrl","replace","trim","originalSanitized","startsWith","test","urlSchemeParseResults","urlScheme","toLowerCase","pathname","search","hash","pass","allowScriptOrDataURI","allowCommsAppURI","allowDBConnectionStringURI","allowServiceAPIURI","allowBrowserSpecificURI","allowWebTransportURI","URISanity","vet"],"mappings":"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"}